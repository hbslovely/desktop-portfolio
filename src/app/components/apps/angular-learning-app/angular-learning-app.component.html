<div class="angular-learning-container">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed()">
    <div class="sidebar-header">
      <h2><i class="pi pi-book"></i> Học Angular</h2>
      <button class="toggle-btn" (click)="toggleSidebar()" title="Toggle sidebar">
        <i class="pi" [class.pi-angle-left]="!sidebarCollapsed()" [class.pi-angle-right]="sidebarCollapsed()"></i>
      </button>
    </div>

    <div class="sidebar-content">
      <!-- Categories -->
      <div class="categories-section">
        <h3>Chủ đề</h3>
        <div class="category-list">
          @for (category of categories(); track category.id) {
            <button
              class="category-item"
              [class.active]="selectedCategory() === category.id"
              (click)="loadCategory(category.id)">
              <i [class]="category.icon"></i>
              <span>{{ category.name }}</span>
            </button>
          }
        </div>
      </div>

      <!-- Guidelines -->
      @if (!sidebarCollapsed() && guidelines().length > 0) {
        <div class="guidelines-section">
          <h3>Bài học</h3>
          <div class="guideline-list">
            @for (guideline of filteredGuidelines(); track guideline.id) {
              <button
                class="guideline-item"
                [class.active]="selectedGuideline()?.id === guideline.id"
                (click)="selectGuideline(guideline)">
                <i class="pi pi-file"></i>
                <span>{{ guideline.title }}</span>
              </button>
            }
          </div>
        </div>
      }

      <!-- Code Examples -->
      @if (!sidebarCollapsed() && getExamplesForCategory(selectedCategory()).length > 0) {
        <div class="examples-section">
          <h3>Ví dụ Code</h3>
          <div class="example-list">
            @for (example of getExamplesForCategory(selectedCategory()); track example.id) {
              <button
                class="example-item"
                [class.active]="selectedExample()?.id === example.id"
                (click)="loadExample(example)">
                <i class="pi pi-code"></i>
                <span>{{ example.title }}</span>
              </button>
            }
          </div>
        </div>
      }
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed()">
    @if (loading()) {
      <div class="loading-state">
        <i class="pi pi-spin pi-spinner"></i>
        <p>Đang tải nội dung...</p>
      </div>
    } @else if (error()) {
      <div class="error-state">
        <i class="pi pi-exclamation-triangle"></i>
        <p>{{ error() }}</p>
      </div>
    } @else {
      <!-- Content View -->
      <div class="content-view">
        <!-- Guideline Content -->
        @if (selectedGuideline()) {
          <div class="guideline-viewer">
            <div class="viewer-header">
              <h1>{{ selectedGuideline()!.title }}</h1>
              <div class="viewer-actions">
                <a [href]="selectedGuideline()!.url" target="_blank" class="external-link">
                  <i class="pi pi-external-link"></i> Xem trên Angular.dev
                </a>
              </div>
            </div>
            <div class="viewer-content" [innerHTML]="selectedGuideline()!.content"></div>
          </div>
        }

        <!-- Code Editor Section -->
        @if (selectedExample()) {
          <div class="code-editor-section">
            <div class="editor-header">
              <h2>{{ selectedExample()!.title }}</h2>
              <p class="example-description">{{ selectedExample()!.description }}</p>
              <div class="editor-tabs">
                <button
                  class="tab-btn"
                  [class.active]="editorMode() === 'html'"
                  (click)="setEditorMode('html')">
                  <i class="pi pi-code"></i> HTML
                </button>
                <button
                  class="tab-btn"
                  [class.active]="editorMode() === 'css'"
                  (click)="setEditorMode('css')">
                  <i class="pi pi-palette"></i> CSS
                </button>
                <button
                  class="tab-btn"
                  [class.active]="editorMode() === 'typescript'"
                  (click)="setEditorMode('typescript')">
                  <i class="pi pi-cog"></i> TypeScript
                </button>
              </div>
            </div>

            <div class="editor-container">
              <div class="editor-toolbar">
                <button class="toolbar-btn" (click)="resetCode()" title="Reset code">
                  <i class="pi pi-refresh"></i> Reset
                </button>
                <button
                  class="toolbar-btn run-btn"
                  (click)="buildAndRun()"
                  [disabled]="isRunning()"
                  title="Build và chạy">
                  <i class="pi" [class.pi-play]="!isRunning()" [class.pi-spin]="isRunning()" [class.pi-spinner]="isRunning()"></i>
                  {{ isRunning() ? 'Đang chạy...' : 'Build & Run' }}
                </button>
              </div>

              <div class="editor-wrapper">
                <textarea
                  class="code-editor"
                  [value]="editorMode() === 'html' ? htmlCode() : editorMode() === 'css' ? cssCode() : typescriptCode()"
                  (input)="editorMode() === 'html' ? htmlCode.set($any($event.target).value) : editorMode() === 'css' ? cssCode.set($any($event.target).value) : typescriptCode.set($any($event.target).value)"
                  [placeholder]="'Nhập code ' + editorMode() + '...'"
                  spellcheck="false">
                </textarea>
              </div>
            </div>

            <!-- Preview Area -->
            <div class="preview-section">
              <div class="preview-header">
                <h3><i class="pi pi-eye"></i> Preview</h3>
              </div>
              <div class="preview-container">
                <iframe
                  #previewFrame
                  class="preview-frame"
                  sandbox="allow-scripts allow-same-origin"
                  title="Code Preview">
                </iframe>
                @if (!isRunning() && !hasPreviewContent()) {
                  <div class="preview-placeholder">
                    <i class="pi pi-play-circle"></i>
                    <p>Nhấn "Build & Run" để xem kết quả</p>
                  </div>
                }
              </div>
            </div>
          </div>
        } @else {
          <div class="welcome-state">
            <div class="welcome-content">
              <i class="pi pi-book"></i>
              <h2>Chào mừng đến với Angular Learning!</h2>
              <p>Chọn một chủ đề từ sidebar để bắt đầu học Angular</p>
              <p class="hint">Hoặc chọn một ví dụ code để thực hành</p>
            </div>
          </div>
        }
      </div>
    }
  </main>
</div>

