<div class="news-hub-v2" [class.viewing-article]="showArticleViewer()">
  <!-- Main Content View -->
  <div class="main-view" *ngIf="!showArticleViewer()">
    
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="brand">
        <i class="pi pi-bolt"></i>
        <span class="brand-text">DEV<span class="highlight">News</span></span>
      </div>
      
      <div class="top-controls">
        <!-- Search -->
        <div class="search-box">
          <i class="pi pi-search"></i>
          <input 
            type="text" 
            placeholder="Search articles..." 
            [value]="searchTerm()"
            (input)="onSearchChange($event)">
          <button *ngIf="searchTerm()" (click)="clearSearch()" class="clear-search" title="Clear search">
            <i class="pi pi-times"></i>
          </button>
        </div>

        <!-- View Modes -->
        <div class="view-modes">
          <button
            *ngFor="let mode of viewModes"
            (click)="setViewMode(mode.id)"
            [class.active]="viewMode() === mode.id"
            class="mode-btn"
            [title]="mode.tooltip">
            <i [class]="mode.icon"></i>
          </button>
        </div>

        <!-- Refresh -->
        <button (click)="refreshNews()" class="refresh-btn" [class.loading]="loading()" title="Refresh articles">
          <i class="pi pi-refresh"></i>
        </button>
      </div>
    </div>

    <!-- Category Pills -->
    <div class="category-bar">
      <div class="category-scroll">
        <button
          *ngFor="let category of categories"
          (click)="selectCategory(category.id)"
          [class.active]="selectedCategory() === category.id"
          class="category-pill"
          [title]="'Show ' + category.name + ' articles'">
          <i [class]="category.icon"></i>
          <span>{{ category.name }}</span>
        </button>
      </div>
      
      <!-- Filter Dropdown -->
      <div class="filter-dropdown">
        <button
          *ngFor="let filter of filters"
          (click)="selectFilter(filter.id)"
          [class.active]="selectedFilter() === filter.id"
          class="filter-btn"
          [title]="'Filter by ' + filter.name">
          <i [class]="filter.icon"></i>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading()" class="loading-state">
      <div class="spinner-modern"></div>
      <p>Loading amazing content...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error() && !loading()" class="error-state">
      <i class="pi pi-exclamation-circle"></i>
      <h3>Oops! Something went wrong</h3>
      <p>{{ error() }}</p>
      <button (click)="refreshNews()" class="retry-btn">
        <i class="pi pi-refresh"></i>
        Try Again
      </button>
    </div>

    <!-- Articles Grid -->
    <div *ngIf="!loading() && !error()" class="articles-grid" [attr.data-view]="viewMode()">
      
      <!-- Featured Article (First one if available) -->
      <div *ngIf="filteredArticles().length > 0" class="featured-article" (click)="openArticle(filteredArticles()[0])">
        <div class="featured-image">
          <img 
            [src]="filteredArticles()[0].image_url" 
            [alt]="filteredArticles()[0].title"
            (error)="onImageError($event)">
          <div class="featured-overlay"></div>
          <div class="featured-badge" *ngIf="filteredArticles()[0].featured">
            <i class="pi pi-star-fill"></i>
            <span>Featured</span>
          </div>
        </div>
        <div class="featured-content">
          <div class="featured-meta">
            <span class="author">
              <i class="pi pi-user"></i>
              {{ filteredArticles()[0].source }}
            </span>
            <span class="time">{{ getTimeAgo(filteredArticles()[0].published_at) }}</span>
            <span class="reading" *ngIf="filteredArticles()[0].reading_time">
              <i class="pi pi-clock"></i>
              {{ filteredArticles()[0].reading_time }} min
            </span>
          </div>
          <h2 class="featured-title">{{ filteredArticles()[0].title }}</h2>
          <p class="featured-summary">{{ filteredArticles()[0].summary }}</p>
          <div class="featured-tags" *ngIf="filteredArticles()[0].tags && filteredArticles()[0].tags!.length > 0">
            <span *ngFor="let tag of filteredArticles()[0].tags!.slice(0, 3)" class="tag">#{{ tag }}</span>
          </div>
          <div class="featured-stats">
            <span class="stat" *ngIf="filteredArticles()[0].reactions">
              <i class="pi pi-heart-fill"></i>
              {{ filteredArticles()[0].reactions! | formatNumber }}
            </span>
            <span class="stat" *ngIf="filteredArticles()[0].comments_count">
              <i class="pi pi-comment"></i>
              {{ filteredArticles()[0].comments_count! | formatNumber }}
            </span>
          </div>
        </div>
      </div>

      <!-- Regular Articles (Skip first one) -->
      <div 
        *ngFor="let article of filteredArticles().slice(1)" 
        class="article-item"
        (click)="openArticle(article)">
        <div class="article-image">
          <img 
            [src]="article.image_url" 
            [alt]="article.title"
            (error)="onImageError($event)">
          <div class="image-overlay"></div>
          <span class="featured-star" *ngIf="article.featured">
            <i class="pi pi-star-fill"></i>
          </span>
        </div>
        <div class="article-content">
          <div class="article-header">
            <span class="article-author">{{ article.source }}</span>
            <span class="article-time">{{ getTimeAgo(article.published_at) }}</span>
          </div>
          <h3 class="article-title">{{ article.title }}</h3>
          <p class="article-excerpt">{{ article.summary }}</p>
          <div class="article-footer">
            <div class="article-tags" *ngIf="article.tags && article.tags.length > 0">
              <span *ngFor="let tag of article.tags.slice(0, 2)" class="mini-tag">#{{ tag }}</span>
            </div>
            <div class="article-metrics">
              <span class="metric" *ngIf="article.reactions">
                <i class="pi pi-heart"></i>
                {{ article.reactions | formatNumber }}
              </span>
              <span class="metric" *ngIf="article.comments_count">
                <i class="pi pi-comment"></i>
                {{ article.comments_count | formatNumber }}
              </span>
              <span class="metric" *ngIf="article.reading_time">
                <i class="pi pi-clock"></i>
                {{ article.reading_time }}m
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredArticles().length === 0" class="empty-state">
        <div class="empty-icon">
          <i class="pi pi-inbox"></i>
        </div>
        <h3>No articles found</h3>
        <p>Try adjusting your search or filters</p>
        <button (click)="clearSearch(); selectFilter('all')" class="clear-btn">
          Clear Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Article Viewer -->
  <div class="article-viewer" *ngIf="showArticleViewer()">
    <div class="viewer-header">
      <button (click)="closeArticleViewer()" class="back-button" title="Back to articles">
        <i class="pi pi-arrow-left"></i>
        <span>Back</span>
      </button>
      <div class="viewer-actions">
        <button (click)="openInNewTab()" class="action-btn" title="Open in new tab">
          <i class="pi pi-external-link"></i>
        </button>
        <button (click)="closeArticleViewer()" class="action-btn close" title="Close article">
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>

    <div class="viewer-content">
      <!-- Loading -->
      <div *ngIf="articleLoading()" class="article-loading">
        <div class="spinner-modern"></div>
        <p>Loading article...</p>
      </div>

      <!-- Error -->
      <div *ngIf="articleError() && !articleLoading()" class="article-error">
        <i class="pi pi-exclamation-triangle"></i>
        <p>{{ articleError() }}</p>
        <button (click)="openInNewTab()" class="open-external">
          <i class="pi pi-external-link"></i>
          Open in Browser
        </button>
      </div>

      <!-- Article Content -->
      <article *ngIf="!articleLoading() && !articleError() && selectedArticle()" class="article-detail">
        <div class="article-hero" *ngIf="selectedArticle()?.image_url">
          <img [src]="selectedArticle()!.image_url" [alt]="selectedArticle()!.title">
          <div class="hero-overlay"></div>
        </div>

        <div class="article-container">
          <div class="article-meta-bar">
            <div class="meta-left">
              <span class="author-pill">
                <i class="pi pi-user"></i>
                {{ selectedArticle()?.author || selectedArticle()?.source }}
              </span>
              <span class="date-pill">
                <i class="pi pi-calendar"></i>
                {{ getTimeAgo(selectedArticle()!.published_at) }}
              </span>
              <span class="time-pill" *ngIf="selectedArticle()?.reading_time">
                <i class="pi pi-clock"></i>
                {{ selectedArticle()?.reading_time }} min read
              </span>
            </div>
            <div class="meta-stats">
              <span class="stat-pill" *ngIf="selectedArticle()?.reactions">
                <i class="pi pi-heart-fill"></i>
                {{ selectedArticle()!.reactions! | formatNumber }}
              </span>
              <span class="stat-pill" *ngIf="selectedArticle()?.comments_count">
                <i class="pi pi-comment"></i>
                {{ selectedArticle()!.comments_count! | formatNumber }}
              </span>
            </div>
          </div>

          <h1 class="article-heading">{{ selectedArticle()?.title }}</h1>

          <div class="article-tags-row" *ngIf="selectedArticle()?.tags && selectedArticle()!.tags!.length > 0">
            <span *ngFor="let tag of selectedArticle()?.tags" class="article-tag">#{{ tag }}</span>
          </div>

          <div class="article-body" [innerHTML]="selectedArticle()?.body || selectedArticle()?.summary"></div>
        </div>
      </article>
    </div>
  </div>
</div>
