<div class="weather-app">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="loading-spinner">
      <i class="pi pi-spin pi-spinner"></i>
    </div>
    <p>Loading weather data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="error-state">
    <i class="pi pi-exclamation-triangle"></i>
    <p>{{ error() }}</p>
    <button class="btn btn-primary" (click)="refresh()">
      <i class="pi pi-refresh"></i>
      Try Again
    </button>
  </div>

  <!-- Weather Content -->
  <div *ngIf="weatherData() && !loading()" class="weather-content">
    <!-- Header -->
    <div class="weather-header">
      <div class="location-info">
        <i class="pi pi-map-marker"></i>
        <h2>{{ locationName() }}</h2>
      </div>
      <div class="header-actions">
        <button class="icon-btn" (click)="toggleUnits()" [title]="'Switch to ' + (units() === 'metric' ? 'Fahrenheit' : 'Celsius')">
          <i class="pi pi-sync"></i>
          <span>{{ units() === 'metric' ? '°C' : '°F' }}</span>
        </button>
        <button class="icon-btn" (click)="refresh()" title="Refresh">
          <i class="pi pi-refresh"></i>
        </button>
      </div>
    </div>

    <!-- View Tabs -->
    <div class="view-tabs">
      <button
        class="tab"
        [class.active]="selectedView() === 'current'"
        (click)="setView('current')">
        <i class="pi pi-sun"></i>
        <span>Current</span>
      </button>
      <button
        class="tab"
        [class.active]="selectedView() === 'hourly'"
        (click)="setView('hourly')">
        <i class="pi pi-clock"></i>
        <span>Hourly</span>
      </button>
      <button
        class="tab"
        [class.active]="selectedView() === 'daily'"
        (click)="setView('daily')">
        <i class="pi pi-calendar"></i>
        <span>Daily</span>
      </button>
    </div>

    <!-- Current Weather View -->
    <div *ngIf="selectedView() === 'current'" class="current-view">
      <div class="current-main">
        <div class="weather-icon-large">
          <img [src]="getWeatherIcon(weatherData()!.current.icon_num)" [alt]="weatherData()!.current.summary">
        </div>
        <div class="current-temp">
          <div class="temperature">{{ formatTemperature(weatherData()!.current.temperature) }}</div>
          <div class="summary">{{ weatherData()!.current.summary }}</div>
          <div class="feels-like">Feels like {{ formatTemperature(weatherData()!.current.feels_like) }}</div>
        </div>
      </div>

      <div class="current-details">
        <div class="detail-grid">
          <div class="detail-card">
            <i class="pi pi-compass"></i>
            <div class="detail-info">
              <span class="detail-label">Wind</span>
              <span class="detail-value">{{ weatherData()!.current.wind.speed }} m/s {{ weatherData()!.current.wind.dir }}</span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-cloud"></i>
            <div class="detail-info">
              <span class="detail-label">Cloud Cover</span>
              <span class="detail-value">{{ weatherData()!.current.cloud_cover }}%</span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-eye"></i>
            <div class="detail-info">
              <span class="detail-label">Visibility</span>
              <span class="detail-value">{{ weatherData()!.current.visibility }} km</span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-chart-line"></i>
            <div class="detail-info">
              <span class="detail-label">Pressure</span>
              <span class="detail-value">{{ weatherData()!.current.pressure }} hPa</span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-percentage"></i>
            <div class="detail-info">
              <span class="detail-label">Humidity</span>
              <span class="detail-value">{{ weatherData()!.current.humidity }}%</span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-sun"></i>
            <div class="detail-info">
              <span class="detail-label">UV Index</span>
              <span class="detail-value" [style.color]="getUVIndexColor(weatherData()!.current.uv_index)">
                {{ weatherData()!.current.uv_index }} - {{ getUVIndexLevel(weatherData()!.current.uv_index) }}
              </span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-droplet"></i>
            <div class="detail-info">
              <span class="detail-label">Precipitation</span>
              <span class="detail-value">{{ weatherData()!.current.precipitation.total }} mm</span>
            </div>
          </div>

          <div class="detail-card">
            <i class="pi pi-thermometer"></i>
            <div class="detail-info">
              <span class="detail-label">Dew Point</span>
              <span class="detail-value">{{ formatTemperature(weatherData()!.current.dew_point) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Hourly Forecast View -->
    <div *ngIf="selectedView() === 'hourly'" class="hourly-view">
      <div class="forecast-scroll">
        <div class="hourly-card" *ngFor="let hour of getHourlyForecast()">
          <div class="hour-time">{{ formatHour(hour.date) }}</div>
          <img [src]="getWeatherIcon(hour.icon)" [alt]="hour.summary" class="hour-icon">
          <div class="hour-temp">{{ formatTemperature(hour.temperature) }}</div>
          <div class="hour-details">
            <div class="hour-detail">
              <i class="pi pi-droplet"></i>
              <span>{{ getPrecipitationChance(hour) }}%</span>
            </div>
            <div class="hour-detail">
              <i class="pi pi-compass"></i>
              <span>{{ hour.wind.speed }} m/s</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Daily Forecast View -->
    <div *ngIf="selectedView() === 'daily'" class="daily-view">
      <div class="daily-card" *ngFor="let day of getDailyForecast()">
        <div class="day-header">
          <div class="day-info">
            <div class="day-name">{{ formatDay(day.day) }}</div>
            <div class="day-summary">{{ day.summary }}</div>
          </div>
          <img [src]="getWeatherIcon(day.icon)" [alt]="day.summary" class="day-icon">
        </div>

        <div class="day-temps">
          <div class="temp-max">
            <i class="pi pi-arrow-up"></i>
            <span>{{ formatTemperature(day.all_day.temperature_max) }}</span>
          </div>
          <div class="temp-bar">
            <div class="temp-range"></div>
          </div>
          <div class="temp-min">
            <i class="pi pi-arrow-down"></i>
            <span>{{ formatTemperature(day.all_day.temperature_min) }}</span>
          </div>
        </div>

        <div class="day-details">
          <div class="day-detail">
            <i class="pi pi-droplet"></i>
            <span>{{ day.all_day.precipitation.total }} mm</span>
          </div>
          <div class="day-detail">
            <i class="pi pi-compass"></i>
            <span>{{ day.all_day.wind.speed }} m/s</span>
          </div>
          <div class="day-detail">
            <i class="pi pi-cloud"></i>
            <span>{{ $any(day.all_day.cloud_cover)?.['total'] }}%</span>
          </div>
        </div>

        <!-- Period breakdown -->
        <div class="day-periods" *ngIf="day.morning || day.afternoon || day.evening">
          <div class="period" *ngIf="day.morning">
            <span class="period-label">Morning</span>
            <img [src]="getWeatherIcon(day.morning.icon)" class="period-icon">
            <span class="period-temp">{{ formatTemperature(day.morning.temperature) }}</span>
          </div>
          <div class="period" *ngIf="day.afternoon">
            <span class="period-label">Afternoon</span>
            <img [src]="getWeatherIcon(day.afternoon.icon)" class="period-icon">
            <span class="period-temp">{{ formatTemperature(day.afternoon.temperature) }}</span>
          </div>
          <div class="period" *ngIf="day.evening">
            <span class="period-label">Evening</span>
            <img [src]="getWeatherIcon(day.evening.icon)" class="period-icon">
            <span class="period-temp">{{ formatTemperature(day.evening.temperature) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="weather-footer">
      <span class="api-credit">
        <i class="pi pi-info-circle"></i>
        Data provided by <a href="https://www.meteosource.com" target="_blank">Meteosource</a>
      </span>
      <span class="last-updated">
        Last updated: {{ getCurrentTime() }}
      </span>
    </div>
  </div>
</div>

