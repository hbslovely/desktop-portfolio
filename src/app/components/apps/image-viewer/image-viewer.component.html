<div class="image-viewer-container">
  <!-- Toolbar -->
  <div class="toolbar">
    <div class="file-info">
      <i class="pi pi-image"></i>
      <span class="file-name">{{ imageName }}</span>
      <span class="file-type" *ngIf="getFileExtension()">{{ getFileExtension() }}</span>
      <span class="scale-info">{{ (scale() * 100).toFixed(0) }}%</span>
    </div>

    <div class="toolbar-actions">
      <!-- Zoom Controls -->
      <div class="action-group">
        <button class="action-btn" [disabled]="!canZoomOut()" (click)="zoomOut()" title="Zoom Out">
          <i class="pi pi-minus"></i>
        </button>
        <button class="action-btn" (click)="resetZoom()" title="Reset Zoom (1:1)">
          <i class="pi pi-search"></i>
        </button>
        <button class="action-btn" [disabled]="!canZoomIn()" (click)="zoomIn()" title="Zoom In">
          <i class="pi pi-plus"></i>
        </button>
        <button class="action-btn" (click)="fitToWindow()" title="Fit to Window">
          <i class="pi pi-window-maximize"></i>
        </button>
      </div>

      <!-- Rotation Controls -->
      <div class="action-group">
        <button class="action-btn" (click)="rotateLeft()" title="Rotate Left">
          <i class="pi pi-undo"></i>
        </button>
        <button class="action-btn" (click)="rotateRight()" title="Rotate Right">
          <i class="pi pi-redo"></i>
        </button>
      </div>

      <!-- Reset -->
      <button class="action-btn" (click)="resetView()" title="Reset All">
        <i class="pi pi-refresh"></i>
      </button>

      <!-- Save as PNG -->
      <div class="action-group">
        <button class="action-btn save-btn" (click)="openSaveDialog()" title="Save as PNG">
          <i class="pi pi-download"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Image Display Area -->
  <div class="image-area">
    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-state">
      <i class="pi pi-spin pi-spinner"></i>
      <p>Loading {{ imageName }}...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError()" class="error-state">
      <i class="pi pi-exclamation-triangle"></i>
      <h3>Failed to load image</h3>
      <p>{{ errorMessage() }}</p>
    </div>

    <!-- Image Display -->
    <div [class.hidden]="!isLoading() && !hasError()" class="image-container">
      <img
        #imageElement
        [src]="imagePath"
        [alt]="imageName"
        [style.transform]="imageTransform()"
        [class.dragging]="isDragging()"
        (load)="onImageLoad()"
        (error)="onImageError()"
        (mousedown)="onMouseDown($event)"
        (dblclick)="onDoubleClick()"
        draggable="false">
    </div>
  </div>

  <!-- Save as PNG Dialog -->
  <div *ngIf="showSaveDialog()" class="save-dialog-overlay" (click)="closeSaveDialog()">
    <div class="save-dialog" (click)="$event.stopPropagation()">
      <div class="save-dialog-header">
        <h3><i class="pi pi-download"></i> Lưu ảnh dưới dạng PNG</h3>
        <button class="close-btn" (click)="closeSaveDialog()" title="Đóng">
          <i class="pi pi-times"></i>
        </button>
      </div>
      
      <div class="save-dialog-content">
        <div class="form-group">
          <label for="fileName">Tên file:</label>
          <input
            type="text"
            id="fileName"
            [(ngModel)]="saveFileName"
            placeholder="image.png"
            class="file-name-input"
            (keydown.enter)="saveAsPNG()"
            (keydown.escape)="closeSaveDialog()"
            autofocus>
        </div>
        
        <div class="form-group">
          <label for="savePath">Thư mục:</label>
          <select
            id="savePath"
            [(ngModel)]="savePath"
            class="path-select">
            <option *ngFor="let folder of availableFolders" [value]="folder">{{ folder }}</option>
          </select>
        </div>
      </div>
      
      <div class="save-dialog-actions">
        <button class="btn btn-primary" (click)="saveAsPNG()">
          <i class="pi pi-save"></i> Lưu
        </button>
        <button class="btn btn-secondary" (click)="closeSaveDialog()">
          <i class="pi pi-times"></i> Hủy
        </button>
      </div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-left">
      <span>{{ imageName }}</span>
    </div>
    <div class="status-right">
      <span>Scale: {{ (scale() * 100).toFixed(0) }}%</span>
      <span *ngIf="rotation() !== 0">Rotation: {{ rotation() }}°</span>
      <span class="help-text">Scroll to zoom • Drag to pan • Double-click to reset</span>
    </div>
  </div>
</div>
